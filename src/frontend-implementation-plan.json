{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Phase 3 (Frontend): WSP balance display, staking UI fields, and admin token controls",
  "requirements": [
    {
      "id": "REQ-5",
      "summary": "Show the caller’s WSP token balance on the Profile page using backend ledger reads, with friendly loading/error states and consistent formatting.",
      "acceptanceCriteria": [
        "Profile page displays the caller’s WSP balance using a backend call (not derived from cached contribution points).",
        "UI handles loading and error states gracefully (no crashes, shows a user-friendly error).",
        "Displayed balances use consistent formatting (e.g., integer if decimals=0, or fixed decimals if decimals>0)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useWspBalance.ts",
          "operation": "create",
          "description": "Add a React Query hook that calls the backend capability for icrc1_balance_of for the current caller, including identity-scoped query keys and safe enablement when actor/identity are ready."
        },
        {
          "path": "frontend/src/lib/formatTokenAmount.ts",
          "operation": "create",
          "description": "Add a small formatting helper for displaying BigInt token amounts with a configurable decimals parameter and sensible defaults for WSP UI display."
        },
        {
          "path": "frontend/src/pages/ProfilePage.tsx",
          "operation": "modify",
          "description": "Use shadcn-ui components (Card/Separator/Label) to add a WSP Balance display alongside existing contribution points, sourcing data from the new useWspBalance hook; include explicit loading and user-friendly error messaging in English. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/utils/userFacingError.ts",
          "operation": "modify",
          "description": "Extend user-facing error mapping to cover WSP balance fetch failures (e.g., ledger/balance-of errors) with clear English messages."
        }
      ]
    },
    {
      "id": "REQ-6",
      "summary": "Add a frontend-only Staking section to the Profile page with validated inputs and client-side persistence (no backend changes).",
      "acceptanceCriteria": [
        "Profile page includes a clearly labeled \"Staking\" section with fields such as amount to stake and an optional lock/term selector (front-end only).",
        "Staking fields do not modify the backend UserProfile type or save payload; they are stored client-side only (e.g., component state or localStorage) and persist across reloads if localStorage is used.",
        "Client-side validation prevents negative/invalid values and shows English inline validation messages."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/profile/components/StakingSection.tsx",
          "operation": "create",
          "description": "Create a Profile Staking UI section using shadcn-ui form primitives (Input/Label/Select/Card) that stores values via the existing useLocalStorageState hook and performs client-side validation with inline English messages. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/ProfilePage.tsx",
          "operation": "modify",
          "description": "Wire the new StakingSection into the Profile page layout and ensure its state does not affect the UserProfile save payload sent to the backend."
        }
      ]
    },
    {
      "id": "REQ-7",
      "summary": "Add an admin-gated \"Token Operations (Test Mode)\" section in the Admin UI to mint/burn WSP for a specified principal with success/failure feedback and cache refresh.",
      "acceptanceCriteria": [
        "Admin UI shows a \"Token Operations (Test Mode)\" section only when the caller is an admin (consistent with existing admin gating patterns).",
        "Admin can enter a target principal and an amount, then invoke mint or burn; UI shows success/failure feedback in English.",
        "Backend exposes admin-only mint/burn methods that update balances and total supply consistently and reject non-admin callers.",
        "After a successful operation, relevant React Query caches are invalidated/refetched so updated balances are visible (e.g., on Profile or in the admin panel if displayed)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useAdminWspTokenOperations.ts",
          "operation": "create",
          "description": "Create React Query mutation hooks for adminMintWSP and adminBurnWSP that validate inputs, surface backend errors, and invalidate/refetch relevant queries (e.g., currentUserProfile, WSP balance, and any admin views that display balances)."
        },
        {
          "path": "frontend/src/pages/admin/components/TokenOperationsSection.tsx",
          "operation": "create",
          "description": "Add an admin-only UI section using shadcn-ui components (Card/Input/Label/Button) to enter a target principal and amount, invoke mint/burn mutations, and show English success/failure feedback; parse principals with the same Principal.fromText pattern used in existing admin log hooks. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/admin/AdminModerationPage.tsx",
          "operation": "modify",
          "description": "Wire TokenOperationsSection into the existing admin page (which already uses admin gating) and ensure the section only renders when admin access is confirmed."
        },
        {
          "path": "frontend/src/utils/userFacingError.ts",
          "operation": "modify",
          "description": "Extend user-facing error mapping for admin token operations (invalid principal, invalid amount, unauthorized, burn failure) with clear English messages suitable for inline and toast usage."
        }
      ]
    }
  ]
}